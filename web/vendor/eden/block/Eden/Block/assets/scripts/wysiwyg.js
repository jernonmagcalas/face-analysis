(function(e){"use strict";var t=function(t){var n=e.Deferred(),r=new FileReader;r.onload=function(e){n.resolve(e.target.result)};r.onerror=n.reject;r.onprogress=n.notify;r.readAsDataURL(t);return n.promise()};e.fn.cleanHtml=function(){var t=e(this).html();return t&&t.replace(/(<br>|\s|<div><br><\/div>|Â )*$/,"")};e.fn.wysiwyg=function(n){var r=this,i,s,o,u=function(){if(s.activeToolbarClass){e(s.toolbarSelector).find(o).each(function(){var t=e(this).data(s.commandRole);if(document.queryCommandState(t)){e(this).addClass(s.activeToolbarClass)}else{e(this).removeClass(s.activeToolbarClass)}})}},a=function(e,t){var n=e.split(" "),r=n.shift(),i=n.join(" ")+(t||"");document.execCommand(r,0,i);u()},f=function(t){e.each(t,function(e,t){r.keydown(e,function(e){if(r.attr("contenteditable")&&r.is(":visible")){e.preventDefault();e.stopPropagation();a(t)}}).keyup(e,function(e){if(r.attr("contenteditable")&&r.is(":visible")){e.preventDefault();e.stopPropagation()}})})},l=function(){var e=window.getSelection();if(e.getRangeAt&&e.rangeCount){return e.getRangeAt(0)}},c=function(){i=l()},h=function(){var e=window.getSelection();if(i){try{e.removeAllRanges()}catch(t){document.body.createTextRange().select();document.selection.empty()}e.addRange(i)}},p=function(n){r.focus();e.each(n,function(n,r){if(/^image\//.test(r.type)){e.when(t(r)).done(function(e){a("insertimage",e)}).fail(function(e){s.fileUploadError("file-reader",e)})}else{s.fileUploadError("unsupported-file-type",r.type)}})},d=function(e,t){h();if(document.queryCommandSupported("hiliteColor")){document.execCommand("hiliteColor",0,t||"transparent")}c();e.data(s.selectionMarker,t)},v=function(t,n){t.find(o).click(function(){h();r.focus();a(e(this).data(n.commandRole));c()});t.find("[data-toggle=dropdown]").click(h);t.find("input[type=text][data-"+n.commandRole+"]").on("webkitspeechchange change",function(){var t=this.value;this.value="";h();if(t){r.focus();a(e(this).data(n.commandRole),t)}c()}).on("focus",function(){var t=e(this);if(!t.data(n.selectionMarker)){d(t,n.selectionColor);t.focus()}}).on("blur",function(){var t=e(this);if(t.data(n.selectionMarker)){d(t,false)}});t.find("input[type=file][data-"+n.commandRole+"]").change(function(){h();if(this.type==="file"&&this.files&&this.files.length>0){p(this.files)}c();this.value=""})},m=function(){r.on("dragenter dragover",false).on("drop",function(e){var t=e.originalEvent.dataTransfer;e.stopPropagation();e.preventDefault();if(t&&t.files&&t.files.length>0){p(t.files)}})};s=e.extend({},e.fn.wysiwyg.defaults,n);o="a[data-"+s.commandRole+"],button[data-"+s.commandRole+"],input[type=button][data-"+s.commandRole+"]";f(s.hotKeys);if(s.dragAndDropImages){m()}v(e(s.toolbarSelector),s);r.attr("contenteditable",true).on("mouseup keyup mouseout",function(){c();u()});e(window).bind("touchend",function(e){var t=r.is(e.target)||r.has(e.target).length>0,n=l(),i=n&&n.startContainer===n.endContainer&&n.startOffset===n.endOffset;if(!i||t){c();u()}});return this};e.fn.wysiwyg.defaults={hotKeys:{"ctrl+b meta+b":"bold","ctrl+i meta+i":"italic","ctrl+u meta+u":"underline","ctrl+z meta+z":"undo","ctrl+y meta+y meta+shift+z":"redo","ctrl+l meta+l":"justifyleft","ctrl+r meta+r":"justifyright","ctrl+e meta+e":"justifycenter","ctrl+j meta+j":"justifyfull","shift+tab":"outdent",tab:"indent"},toolbarSelector:"[data-role=editor-toolbar]",commandRole:"edit",activeToolbarClass:"btn-info",selectionMarker:"edit-focus-marker",selectionColor:"darkgrey",dragAndDropImages:true,fileUploadError:function(e,t){console.log("File upload error",e,t)}}})(window.jQuery);(function(e){e.fn.wyzi=function(t,n){return this.each(function(){var r=this;var i=this;if(r.tagName.toLowerCase()=="textarea"){var s=e(r).hide().val();i=e('<div class="eden-wysiwyg-editor"></div>').html(s);e(r).before(i)}if(!t){t=e(i).prev()}n=e.extend({activeToolbarClass:"btn-info",toolbarSelector:t},n||{});var o=e(i);var u=false;e("a[data-view=source]",t).on("click",function(t){t.preventDefault();if(!u){e('<textarea class="eden-wysiwyg-source" />').css({width:o.outerWidth(),height:o.outerHeight()}).val(o.html()).insertAfter(o);o.hide();e(this).addClass(n.activeToolbarClass)}else{var r=o.siblings("textarea.eden-wysiwyg-source");o.html(r.val()).show();r.remove();e(this).removeClass(n.activeToolbarClass)}u=!u});e(".dropdown-menu input:not([type=file])",t).on("click",function(e){e.stopPropagation();return false}).on("change",function(t){e(this).closest(".dropdown-menu").siblings(".dropdown-toggle").dropdown("toggle")}).on("keydown",function(t){if(t.which==27){this.value="";e(this).change()}});e("input[type=file]",t).prev().on("click",function(t){e(this).next().click()});e("a.colorpick-btn",t).on("click",function(n){e('input[data-edit="foreColor"]',t).eq(0).val(e(this).attr("data-color")).change();n.preventDefault();return false});e(i).wysiwyg(n);e(r).parents("form:first").submit(function(i){if(u){var s=o.next();o.html(s.val()).show();s.remove();e("a[data-view=source]",t).removeClass(n.activeToolbarClass)}e(r).val(o.html())})})}})(window.jQuery)